<!DOCTYPE html>
<html>

<head>
  <!-- Basic Page Needs
    ================================================== -->
  <meta charset="utf-8">
  <base href="https://kubuds.io">
  <!-- Mobile Specific Metas
    ================================================== -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="上海苦芽科技有限公司">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="author" content="kubuds">
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/assets/img/favicon.ico" />

  <!-- Preload critical resources -->
  <link rel="preload" href="/assets/img/home/home.webp" as="image" type="image/webp">
  <link rel="preload" href="/assets/css/style.css" as="style">
  <link rel="preload" href="/assets/js/lazy-loading.js" as="script">

  <!-- bootstrap.min css -->
  <link rel="stylesheet" href="/assets/plugins/bootstrap/bootstrap.min.css">
  <!-- Ionic Icon Css -->
  <link rel="stylesheet" href="/assets/plugins/Ionicons/css/ionicons.min.css">
  <!-- animate.css -->
  <link rel="stylesheet" href="/assets/plugins/animate-css/animate.css" media="print" onload="this.media='all'">
  <!-- Magnify Popup -->
  <link rel="stylesheet" href="/assets/plugins/magnific-popup/magnific-popup.css" media="print"
    onload="this.media='all'">
  <!-- Slick CSS -->
  <link rel="stylesheet" href="/assets/plugins/slick/slick.css" media="print" onload="this.media='all'">

  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="/assets/css/style.css">

  <!-- Lazy Loading Stylesheet -->
  <link rel="stylesheet" href="/assets/css/lazy-loading.css">

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('/assets/js/sw.js')
          .then(function (registration) {
            console.log('ServiceWorker registration successful');
          })
          .catch(function (err) {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }
  </script>

</head>
<!-- Header -->
<header class="navigation fixed-top d-flex align-items-center">
  <div class="container">

    <!-- <div class="logo me-auto"></div> -->
    <nav class="navbar navbar-expand-lg p-0">
      
      <!-- <h2><a href="/ch/index.html">苦芽</a></h2> -->
      <a class="navbar-brand" href="/ch/index.html">
        <!-- <img class="logo_ch" src="/assets/img/logos/kubuds_ch.png" alt="Logo"> -->
        <img class="logo" src="/assets/img/logos/kubuds_en.webp" alt="Logo">

      </a>
      

      <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarsExample09"
        aria-controls="navbarsExample09" aria-expanded="false" aria-label="Toggle navigation">
        <span class="ion-android-menu"></span>
      </button>

      <div class="collapse navbar-collapse ml-auto" id="navbarsExample09">
        <ul id="navbar-main" class="navbar-nav ml-auto ">
          <!-- <li class="nav-item active">
                
                <a class="nav-link" href="/ch/">首页</a>
                
              </li> -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">服务与支持 <span class="ion-ios-arrow-down"></span></a>
            <ul class="dropdown-menu" aria-labelledby="dropdown05">
              
              <li><a class="dropdown-item" href="/ch/service/simulator.html">模拟器</a></li>
              <li><a class="dropdown-item" href="/ch/service/os.html">操作系统</a></li>
              <li><a class="dropdown-item" href="/ch/service/toolchain.html">软件工具链</a></li>
              <li><a class="dropdown-item" href="/ch/service/chip.html">嵌入式芯片</a></li>

              <li><a class="dropdown-item" href="/ch/service/ide.html">集成开发环境</a></li>
              <li><a class="dropdown-item" href="/ch/service/aisys.html">AI软件栈服务</a></li>
              <li><a class="dropdown-item" href="/ch/service/consultation.html">专家咨询</a></li>
              
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">解决方案 <span class="ion-ios-arrow-down"></span></a>
            <ul class="dropdown-menu" aria-labelledby="dropdown05">
              
              <li><a class="dropdown-item" href="/ch/solution/openharmony.html">OpenHarmony</a></li>
              <li><a class="dropdown-item" href="/ch/solution/openeuler.html">openEuler</a></li>
              <li><a class="dropdown-item" href="/ch/solution/openkylin.html">openKylin</a></li>
              <li><a class="dropdown-item" href="/ch/solution/aosp.html">AOSP</a></li>
              
            </ul>
          </li>
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">社区 <span class="ion-ios-arrow-down"></span></a>
            <ul class="dropdown-menu" aria-labelledby="dropdown05">
              
              <li><a class="dropdown-item" href="/ch/community/openeuler.html">openEuler</a></li>
              
            </ul>
          </li>
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">关于我们 <span class="ion-ios-arrow-down"></span></a>
            <ul class="dropdown-menu" aria-labelledby="dropdown05">
              
              <li><a class="dropdown-item" href="/ch/about.html">关于苦芽</a></li>
              <li><a class="dropdown-item" href="/ch/post.html">新闻与活动</a></li>
              
            </ul>
          </li>

          <!-- <li class="nav-item ">
            
            <a class="nav-link" href="/ch/career.html">招贤纳士</a>
            
          </li> -->
        </ul>
        <ul class="navbar-nav ml-auto navbar-language">
          <li class="nav-item "><a class="nav-link">contact@kubuds.cn</a></li>
          <li class="nav-item dropdown">

            <a class="nav-link dropdown-toggle" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">
              <svg xmlns="http://www.w3.org/2000/svg" height="1.25rem" viewBox="0 -960 960 960" width="1.25rem"
                fill="#211f1f">
                <path
                  d="M480-96q-79 0-149-30t-122.5-82.5Q156-261 126-331T96-480q0-80 30-149.5t82.5-122Q261-804 331-834t149-30q80 0 149.5 30t122 82.5Q804-699 834-629.5T864-480q0 79-30 149t-82.5 122.5Q699-156 629.5-126T480-96Zm0-75q17-17 34-63.5T540-336H420q9 55 26 101.5t34 63.5Zm-91-10q-14-30-24.5-69T347-336H204q29 57 77 97.5T389-181Zm182 0q60-17 108-57.5t77-97.5H613q-7 47-17.5 86T571-181ZM177-408h161q-2-19-2.5-37.5T335-482q0-18 .5-35.5T338-552H177q-5 19-7 36.5t-2 35.5q0 18 2 35.5t7 36.5Zm234 0h138q2-20 2.5-37.5t.5-34.5q0-17-.5-35t-2.5-37H411q-2 19-2.5 37t-.5 35q0 17 .5 35t2.5 37Zm211 0h161q5-19 7-36.5t2-35.5q0-18-2-36t-7-36H622q2 19 2.5 37.5t.5 36.5q0 18-.5 35.5T622-408Zm-9-216h143q-29-57-77-97.5T571-779q14 30 24.5 69t17.5 86Zm-193 0h120q-9-55-26-101.5T480-789q-17 17-34 63.5T420-624Zm-216 0h143q7-47 17.5-86t24.5-69q-60 17-108 57.5T204-624Z" />
              </svg>
              中文 <span class="ion-ios-arrow-down"></span></a>
            <ul class="dropdown-menu" aria-labelledby="dropdown05">
              
              
              
              <li><a class="dropdown-item" href="/2025/07/18/OpenCloudOS-RISC-V-SIG-Successfully-Adapts-EDK-II-en/">
                  English</a></li>
              
              
              
              
              
            </ul>
          </li>
        </ul>
      </div>
    </nav>

  </div>
</header>
<!-- Main jQuery -->
<script src="/assets/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 3.1 -->
<script src="/assets/plugins/bootstrap/bootstrap.min.js"></script>
<!-- slick Carousel -->
<script src="/assets/plugins/slick/slick.min.js"></script>
<script src="/assets/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>
<!-- filter -->
<script src="/assets/plugins/shuffle/shuffle.min.js"></script>
<script src="/assets/plugins/SyoTimer/jquery.syotimer.min.js"></script>
<!-- Google Map -->
<!-- <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcABaamniA6OL5YvYSpB3pFMNrXwXnLwU&libraries=places"></script>
<script src="/assets/plugins/google-map/map.js"></script> -->

<!-- Lazy Loading Script -->
<script src="/assets/js/lazy-loading.js"></script>

<script src="/assets/js/main.js"></script>

<head>
    <title>Enabling OpenCloudOS Adaptation for Milk-V Megrez Development Board - 苦芽</title>
</head>

<body>
    <main id="main">
        <section class="section-top section post-detail-section">
            <div class="container section-top">
                <div class="row section-top ">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <!-- 面包屑导航 -->
                        <nav class="breadcrumb-nav">
                            <ol class="breadcrumb">
                                
                                <li class="breadcrumb-item"><a href="/ch">首页</a></li>
                                <li class="breadcrumb-item"><a href="/ch/post.html#news-list" class="news-list-link">新闻与活动</a>
                                </li>
                                <li class="breadcrumb-item active">Enabling OpenCloudOS Adaptation for Milk-V Megrez Development Board</li>
                                
                            </ol>
                        </nav>
                        <div class="post-content-wrapper">
                            <div class="post-header text-center">
                                <h4>Enabling OpenCloudOS Adaptation for Milk-V Megrez Development Board</h4>
                                <div class="post-meta">
                                    <span class="post-date">2025-07-18</span>
                                    <span class="post-author">RISC-V Prosperity 2036 Joint Training Program</span>
                                </div>
                            </div>
                            <div class="post-content">
                                <p>Recently, the OpenCloudOS RISC-V SIG successfully adapted EDK II, and the adaptation results have been recognized by the OpenCloudOS community. Experience the fascinating journey from firmware to operating system with just one command. Currently, the distribution containing EDK II has been released on the official OpenCloudOS mirror website [1]. We welcome you to try it out.</p>

<p>This work was completed by Luna, an intern at the Institute of Software, Chinese Academy of Sciences PLCT Laboratory, with mentorship from Engineer Sun Min of <strong>Kubuds Technology</strong>. The delegated training community is the OpenCloudOS community, forming part of the ‘RISC-V Prosperity 2036 Open Source Intern Joint Recruitment and Training Program’.</p>

<p><strong>Introduction to OpenCloudOS</strong></p>

<p>OpenCloudOS (abbreviated as OC) is an open-source cloud-native operating system project jointly initiated and maintained by leading domestic technology companies. Designed as a next-generation OS for cloud infrastructure and edge computing scenarios, its core features include:</p>

<ul>
  <li>Cloud-native architecture</li>
  <li>High-performance kernel</li>
  <li>Full-stack domestic adaptation</li>
  <li>Security and compliance system</li>
</ul>

<p><strong>Introduction to OC Community RV SIG</strong></p>

<p>The OC RISC-V Special Interest Group (OC RV SIG) is a core working group within the OpenCloudOS community focused on RISC-V architecture adaptation. Its primary missions include:</p>

<ul>
  <li>Hardware adaptation and kernel support
In-depth adaptation for mainstream RISC-V cores like SG2042, EIC7700x, UR-DP1000
Co-source kernel support, providing LTS maintenance for the RISC-V architecture under oc-kernel</li>
  <li>Software stack construction
Development of lightweight Runtime containers, supporting cross-architecture RISC-V container image builds
Support for the RVA23 baseline, building a high-performance RISC-V operating system。</li>
</ul>

<p><strong>Introduction to EDK II</strong></p>

<p>EDK II is an open-source BIOS project developed by Intel, used for building BIOS firmware. The project provides a complete BIOS development environment, including compilation toolchains, compilation scripts, and BIOS source code. As an open-source UEFI project itself, it is based on Intel’s UEFI standard and is also applicable to the RISC-V architecture.</p>

<p><strong>Adaptation Approach</strong></p>

<p>Boot chain:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>&gt; QEMU built-in OpenSBI -&gt; EDK II Boot -&gt; GNU GRUB -&gt; OpenCloudOS Kernel -&gt; OpenCloudOS Initramfs -&gt; OpenCloudOS Rootfs

</code></pre>
</div>

<ul>
  <li>The EDK II boot chain reads the first <code class="highlighter-rouge">vfat</code> formatted disk and loads the file <code class="highlighter-rouge">bootriscv64.efi</code> (since the system is 64-bit) as the bootloader.</li>
  <li>This file is provided by the EDK II project for booting the EDK II project itself.</li>
  <li>GNU GRUB is used as the bootloader within the chain to load the OpenCloudOS Kernel.</li>
  <li>GNU GRUB loads the OpenCloudOS Kernel and the OpenCloudOS Initramfs, then proceeds to the rootfs.</li>
</ul>

<p><strong>Adaptation Challenges</strong></p>

<ul>
  <li>In the OpenCloudOS kernel, CONFIG_NUMA needs to be enabled.</li>
  <li>In the OpenCloudOS rootfs, the UUID of the target hard disk to be read is hardcoded in <code class="highlighter-rouge">/etc/fstab</code>. Therefore, when migrating this rootfs, the current hard disk UUID must be manually written.</li>
  <li>The self-compiled kernel and the hardware architecture must match — if extended features are enabled at the OS level, the corresponding extended features must be present in the virtual machine (or physical hardware).</li>
  <li>The two UEFI files generated by EDK II are recommended to be set to 32MB to match the ROM loading process during RISC-V boot.</li>
</ul>

<p><strong>How to Experience the Distribution with QEMU?</strong></p>

<p>Note! Requires QEMU version: &gt;=8.0.0</p>

<p><strong>Build the Image Yourself</strong></p>

<p>Refer to the links at the end [2][3][4].</p>

<p><strong>Run the Official Image Directly</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>wget -r -np -nH --cut-dirs=6 -P ocs-riscv --reject="index.html*" https://mirrors.opencloudos.tech/opencloudos-stream/releases/23/images/riscv64/uefi-qemu/ &amp;&amp; cd ocs-riscv &amp;&amp; unxz -dv ocs23-riscv-uefi-20250716.qcow2.xz

</code></pre>
</div>

<p><strong>Booting via QEMU Emulation</strong></p>

<ul>
  <li>In a Linux environment:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>qemu-system-riscv64 \
    -machine virt,pflash0=pflash0,pflash1=pflash1,acpi=off \
    -cpu max \
    -nographic \
    -m 8G \
    -smp 8 \
    -blockdev node-name=pflash0,driver=file,read-only=on,filename=./uefi/RISCV_VIRT_CODE_32M.fd \
    -blockdev node-name=pflash1,driver=file,filename=./uefi/RISCV_VIRT_VARS_32M.fd \
    -drive file=./luna_oc_riscv_6.6.94.qcow2,format=qcow2,if=virtio,index=0,media=disk
</code></pre>
</div>

<ul>
  <li>In a Windows PowerShell environment:</li>
</ul>

<div class="highlighter-rouge"><pre class="highlight"><code>qemu-system-riscv64 ^
	-cpu max ^
	-m 8G ^
	-smp 8 ^
	-nographic ^
	-machine virt,pflash0=pflash0,pflash1=pflash1,acpi=off ^
	-blockdev node-name=pflash0,driver=file,read-only=on,filename=./uefi/RISCV_VIRT_CODE_32M.fd ^
	-blockdev node-name=pflash1,driver=file,filename=./uefi/RISCV_VIRT_VARS_32M.fd ^
	-device usb-ehci,id=ehci ^
	-device usb-kbd,bus=ehci.0 ^
	-serial mon:stdio ^
	-boot menu=on ^
	-drive file=./luna_oc_riscv_6.6.94.qcow2,format=qcow2,if=virtio ^
	-netdev user,id=net0,hostfwd=tcp::88-:22,hostfwd=tcp::396-:5432 ^
	-device virtio-net-device,netdev=net0
</code></pre>
</div>

<p><strong>Screenshots of Successful QEMU Boot</strong></p>

<p>Linux environment</p>

<p><img src="2025/07/18/OpenCloudOS-RISC-V-SIG-Successfully-Adapts-EDK-II/1.webp" alt="image" /></p>

<p>Windows PowerShell environment</p>

<p><img src="2025/07/18/OpenCloudOS-RISC-V-SIG-Successfully-Adapts-EDK-II/2.webp" alt="image" /></p>

<p><strong>Next Steps</strong></p>

<p>Currently, efforts are underway to build an automated program that can generate a bootable Linux system ISO image based on EDK2 and GNU GRUB.</p>

<p>This issue depends on the resolution of some upstream driver-related problems in the system; otherwise, existing configuration files will still need to be used.</p>

<p><strong>Acknowledgments</strong></p>

<p>Thanks to the technical support from the UEFI team led by Professor Dai Hongjun of Shandong University and the strong support from Teacher Chen Xinlong of the OC community.</p>

<p><strong>About Intern Luna</strong></p>

<p>“A large feline who likes to take it easy, sometimes sitting by the computer with a cup of coffee all day.”</p>

<p><strong>Reference Links</strong></p>

<p>[1] https://mirrors.opencloudos.tech/opencloudos-stream/releases/23/images/riscv64/uefi-qemu/</p>

<p>[2] https://github.com/LunaticLegacy/OpencloudOsLaunch.git</p>

<p>[3] https://gitee.com/lunaneko/OpencloudOsLaunch</p>

<p>[4] https://github.com/AII-SDU/rv-sp-test-mod.git</p>

                            </div>
                        </div>
                        <div class="post-navigation">
                            
                            <a href="/ch/post.html#news-list" class="btn btn-main news-list-link">返回新闻列表</a>
                            
                        </div>

                    </div>
                </div>
            </div>
        </section>
    </main>
</body>
<!-- Footer -->
<!-- 
<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="footer-manu">
          <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="contact.html">Contact us</a></li>
            <li><a href="service.html">How it works</a></li>
            <li><a href="faq.html">FAQ</a></li>
            <li><a href="pricing.html">Pricing</a></li>
          </ul>
        </div>
        <p class="copyright mb-0">Copyright
          <script>document.write(new Date().getFullYear())</script> &copy; Designed & Developed by <a
            href="http://www.themefisher.com">Themefisher</a>. All rights reserved.
          <br> Get More <a href="https://themefisher.com/free-bootstrap-templates/">Free Bootstrap
            Templates</a>
        </p>
      </div>
    </div>
  </div>
</footer> -->


<footer class="footer">
  <div class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 col-md-4 ">
          <h4>联系我们</h4>
          <p>
            Weiwei Li (CEO) <br>
            <!-- Phone:  <br>
          Fax:  <br> -->
            <strong>邮箱:</strong> contact@kubuds.cn<br>
            <strong>地址:</strong> 上海市宝山区高逸路88号1幢1层108室<br>
          </p>
        </div>

        <div class="col-lg-4 col-md-4 ">
          <h4>链接</h4>
          <ul>
            <li><i class="bx bx-chevron-right"></i><a href="https://github.com/kubuds"> GitHub</a></li>
          </ul>
        </div>
        
        <div class="col-lg-4 col-md-4 ">
          <h4>关注我们</h4>
          <img src="/assets/img/contact/qrcode_wechat_public_account_100px.webp" class="img-fluid text-left"
            alt="weixin_public_qrcode">
        </div>
        
      </div>
    </div>

  </div>
  <div class="footer-copyright container">
    <div class="me-md-auto text-center ">
      <div class="copyright">
        <p>Copyright &copy; 2025 上海苦芽科技有限公司</p>
      </div>
    </div>
  </div>
</footer>

<script>
    // 新闻详情页面滚动位置保持功能
    (function () {
        const NEWS_LIST_SCROLL_KEY = 'newsListScrollPosition';
        const NEWS_LIST_TIMESTAMP_KEY = 'newsListTimestamp';

        // 为所有返回新闻列表的链接添加点击事件监听器
        function addNewsListLinkListeners() {
            const newsListLinks = document.querySelectorAll('.news-list-link');
            newsListLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    // 不需要在这里保存位置，因为位置应该在从列表页进入详情页时已经保存了
                    // 这里只需要确保链接正常工作
                });
            });
        }

        // 新闻详情页图片懒加载
        function initNewsImageLazyLoading() {
            const images = document.querySelectorAll('.post-content img');

            if (images.length === 0) return;

            const imageObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;

                        // 添加加载状态
                        img.style.opacity = '0.7';
                        img.style.transition = 'opacity 0.3s ease';

                        // 预加载图片
                        const tempImg = new Image();
                        tempImg.onload = function () {
                            img.style.opacity = '1';
                            img.classList.add('loaded');
                        };
                        tempImg.onerror = function () {
                            img.style.opacity = '1';
                            img.alt = '图片加载失败';
                            img.classList.add('loaded');
                        };
                        tempImg.src = img.src;

                        imageObserver.unobserve(img);
                    }
                });
            }, {
                rootMargin: '100px 0px',
                threshold: 0.1
            });

            images.forEach(img => {
                // 为所有图片添加懒加载属性
                img.setAttribute('loading', 'lazy');
                imageObserver.observe(img);
            });
        }

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function () {
            // 添加新闻列表链接监听器
            addNewsListLinkListeners();

            // 初始化图片懒加载
            initNewsImageLazyLoading();
        });
    })();
</script>

</html>