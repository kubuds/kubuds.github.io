<!DOCTYPE html>
<html>

<head>
  <!-- Basic Page Needs
    ================================================== -->
  <meta charset="utf-8">
  <base href="https://kubuds.io">
  <!-- Mobile Specific Metas
    ================================================== -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="上海苦芽科技有限公司">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
  <meta name="author" content="kubuds">
  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="/assets/img/favicon.ico" />

  <!-- Preload critical resources -->
  <link rel="preload" href="/assets/img/home/home.webp" as="image" type="image/webp">
  <link rel="preload" href="/assets/css/style.css" as="style">
  <link rel="preload" href="/assets/js/lazy-loading.js" as="script">

  <!-- bootstrap.min css -->
  <link rel="stylesheet" href="/assets/plugins/bootstrap/bootstrap.min.css">
  <!-- Ionic Icon Css -->
  <link rel="stylesheet" href="/assets/plugins/Ionicons/css/ionicons.min.css">
  <!-- animate.css -->
  <link rel="stylesheet" href="/assets/plugins/animate-css/animate.css" media="print" onload="this.media='all'">
  <!-- Magnify Popup -->
  <link rel="stylesheet" href="/assets/plugins/magnific-popup/magnific-popup.css" media="print"
    onload="this.media='all'">
  <!-- Slick CSS -->
  <link rel="stylesheet" href="/assets/plugins/slick/slick.css" media="print" onload="this.media='all'">

  <!-- Main Stylesheet -->
  <link rel="stylesheet" href="/assets/css/style.css">

  <!-- Lazy Loading Stylesheet -->
  <link rel="stylesheet" href="/assets/css/lazy-loading.css">

  <!-- Service Worker Registration -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('/assets/js/sw.js')
          .then(function (registration) {
            console.log('ServiceWorker registration successful');
          })
          .catch(function (err) {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }
  </script>

</head>
<!-- Header -->
<header class="navigation fixed-top d-flex align-items-center">
  <div class="container">

    <!-- <div class="logo me-auto"></div> -->
    <nav class="navbar navbar-expand-lg p-0">
      
      <!-- <h2><a href="/ch/index.html">苦芽</a></h2> -->
      <a class="navbar-brand" href="/ch/index.html">
        <!-- <img class="logo_ch" src="/assets/img/logos/kubuds_ch.png" alt="Logo"> -->
        <img class="logo" src="/assets/img/logos/kubuds_en.webp" alt="Logo">

      </a>
      

      <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarsExample09"
        aria-controls="navbarsExample09" aria-expanded="false" aria-label="Toggle navigation">
        <span class="ion-android-menu"></span>
      </button>

      <div class="collapse navbar-collapse ml-auto" id="navbarsExample09">
        <ul id="navbar-main" class="navbar-nav ml-auto ">
          <!-- <li class="nav-item active">
                
                <a class="nav-link" href="/ch/">首页</a>
                
              </li> -->
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">服务与支持 <span class="ion-ios-arrow-down"></span></a>
            <ul class="dropdown-menu" aria-labelledby="dropdown05">
              
              <li><a class="dropdown-item" href="/ch/service/simulator.html">模拟器</a></li>
              <li><a class="dropdown-item" href="/ch/service/os.html">操作系统</a></li>
              <li><a class="dropdown-item" href="/ch/service/toolchain.html">软件工具链</a></li>
              <li><a class="dropdown-item" href="/ch/service/chip.html">嵌入式芯片</a></li>

              <li><a class="dropdown-item" href="/ch/service/ide.html">集成开发环境</a></li>
              <li><a class="dropdown-item" href="/ch/service/aisys.html">AI软件栈服务</a></li>
              <li><a class="dropdown-item" href="/ch/service/consultation.html">专家咨询</a></li>
              
            </ul>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">解决方案 <span class="ion-ios-arrow-down"></span></a>
            <ul class="dropdown-menu" aria-labelledby="dropdown05">
              
              <li><a class="dropdown-item" href="/ch/solution/openharmony.html">OpenHarmony</a></li>
              <li><a class="dropdown-item" href="/ch/solution/openeuler.html">openEuler</a></li>
              <li><a class="dropdown-item" href="/ch/solution/openkylin.html">openKylin</a></li>
              <li><a class="dropdown-item" href="/ch/solution/aosp.html">AOSP</a></li>
              
            </ul>
          </li>
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">社区 <span class="ion-ios-arrow-down"></span></a>
            <ul class="dropdown-menu" aria-labelledby="dropdown05">
              
              <li><a class="dropdown-item" href="/ch/community/openeuler.html">openEuler</a></li>
              
            </ul>
          </li>
          
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">关于我们 <span class="ion-ios-arrow-down"></span></a>
            <ul class="dropdown-menu" aria-labelledby="dropdown05">
              
              <li><a class="dropdown-item" href="/ch/about.html">关于苦芽</a></li>
              <li><a class="dropdown-item" href="/ch/post.html">新闻与活动</a></li>
              
            </ul>
          </li>

          <!-- <li class="nav-item ">
            
            <a class="nav-link" href="/ch/career.html">招贤纳士</a>
            
          </li> -->
        </ul>
        <ul class="navbar-nav ml-auto navbar-language">
          <li class="nav-item "><a class="nav-link">contact@kubuds.cn</a></li>
          <li class="nav-item dropdown">

            <a class="nav-link dropdown-toggle" href="#" id="dropdown05" data-toggle="dropdown" aria-haspopup="true"
              aria-expanded="false">
              <svg xmlns="http://www.w3.org/2000/svg" height="1.25rem" viewBox="0 -960 960 960" width="1.25rem"
                fill="#211f1f">
                <path
                  d="M480-96q-79 0-149-30t-122.5-82.5Q156-261 126-331T96-480q0-80 30-149.5t82.5-122Q261-804 331-834t149-30q80 0 149.5 30t122 82.5Q804-699 834-629.5T864-480q0 79-30 149t-82.5 122.5Q699-156 629.5-126T480-96Zm0-75q17-17 34-63.5T540-336H420q9 55 26 101.5t34 63.5Zm-91-10q-14-30-24.5-69T347-336H204q29 57 77 97.5T389-181Zm182 0q60-17 108-57.5t77-97.5H613q-7 47-17.5 86T571-181ZM177-408h161q-2-19-2.5-37.5T335-482q0-18 .5-35.5T338-552H177q-5 19-7 36.5t-2 35.5q0 18 2 35.5t7 36.5Zm234 0h138q2-20 2.5-37.5t.5-34.5q0-17-.5-35t-2.5-37H411q-2 19-2.5 37t-.5 35q0 17 .5 35t2.5 37Zm211 0h161q5-19 7-36.5t2-35.5q0-18-2-36t-7-36H622q2 19 2.5 37.5t.5 36.5q0 18-.5 35.5T622-408Zm-9-216h143q-29-57-77-97.5T571-779q14 30 24.5 69t17.5 86Zm-193 0h120q-9-55-26-101.5T480-789q-17 17-34 63.5T420-624Zm-216 0h143q7-47 17.5-86t24.5-69q-60 17-108 57.5T204-624Z" />
              </svg>
              中文 <span class="ion-ios-arrow-down"></span></a>
            <ul class="dropdown-menu" aria-labelledby="dropdown05">
              
              
              
              <li><a class="dropdown-item" href="/2025/03/02/RV64ILP32-ABI-Embedded-Virtualization-en/">
                  English</a></li>
              
              
              
              
              
            </ul>
          </li>
        </ul>
      </div>
    </nav>

  </div>
</header>
<!-- Main jQuery -->
<script src="/assets/plugins/jquery/jquery.min.js"></script>
<!-- Bootstrap 3.1 -->
<script src="/assets/plugins/bootstrap/bootstrap.min.js"></script>
<!-- slick Carousel -->
<script src="/assets/plugins/slick/slick.min.js"></script>
<script src="/assets/plugins/magnific-popup/jquery.magnific-popup.min.js"></script>
<!-- filter -->
<script src="/assets/plugins/shuffle/shuffle.min.js"></script>
<script src="/assets/plugins/SyoTimer/jquery.syotimer.min.js"></script>
<!-- Google Map -->
<!-- <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcABaamniA6OL5YvYSpB3pFMNrXwXnLwU&libraries=places"></script>
<script src="/assets/plugins/google-map/map.js"></script> -->

<!-- Lazy Loading Script -->
<script src="/assets/js/lazy-loading.js"></script>

<script src="/assets/js/main.js"></script>

<head>
    <title>Enabling RV64ILP32 ABI in Embedded Virtualization - 苦芽</title>
</head>

<body>
    <main id="main">
        <section class="section-top section post-detail-section">
            <div class="container section-top">
                <div class="row section-top ">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <!-- 面包屑导航 -->
                        <nav class="breadcrumb-nav">
                            <ol class="breadcrumb">
                                
                                <li class="breadcrumb-item"><a href="/ch">首页</a></li>
                                <li class="breadcrumb-item"><a href="/ch/post.html#news-list" class="news-list-link">新闻与活动</a>
                                </li>
                                <li class="breadcrumb-item active">Enabling RV64ILP32 ABI in Embedded Virtualization</li>
                                
                            </ol>
                        </nav>
                        <div class="post-content-wrapper">
                            <div class="post-header text-center">
                                <h4>Enabling RV64ILP32 ABI in Embedded Virtualization</h4>
                                <div class="post-meta">
                                    <span class="post-date">2025-03-02</span>
                                    <span class="post-author">Kubuds</span>
                                </div>
                            </div>
                            <div class="post-content">
                                <p>The RV64ILP32 ABI (referred to as “New 32-bit”) holds significant value in the field of high-performance embedded applications. Building upon existing applications (Reference: <a href="https://mp.weixin.qq.com/s?__biz=MzkwODYyMTQ2NA==&amp;mid=2247484450&amp;idx=1&amp;sn=100662365b494233229d5126ef8be042&amp;scene=21#wechat_redirect"><strong>Kubuds Tech Facilitates the First Application Landing of RV64ILP32 ABI</strong></a>), Kubuds Technology continues to explore the possibilities of the “New 32-bit” ecosystem within Hypervisors. On the SiFive P550 hardware platform, the open-source EasyXMen has successfully run on KVM in VS-mode, and the performance overhead introduced by virtualization has been measured. The test results demonstrate the feasibility of running open-source EasyXMen with virtualization, indicating that the performance impact of virtualization is within an acceptable range.</p>

<p><strong>About Embedded Virtualization</strong></p>

<p><img src="2025/03/02/RV64ILP32-ABI-Embedded-Virtualization/1.webp" alt="image" /></p>

<p><strong>Open-Source EasyXMen Virtualization Solution</strong></p>

<p>In the RISC-V architecture, applications can run on hardware in three ways: based on the ABI (bare-metal programs), based on an operating system (requiring SBI specification implementation), and based on a Hypervisor virtual machine (requiring a high-performance CPU). This open-source EasyXMen virtualization solution is implemented using the third approach.</p>

<p><img src="2025/03/02/RV64ILP32-ABI-Embedded-Virtualization/2.webp" alt="image" /></p>

<p><strong>About the HiFive P550 Hardware Platform</strong></p>

<p>The P550 is a high-performance RISC-V development board equipped with an ESWIN EIC7700X SoC and a SiFive quad-core P550 64-bit out-of-order CPU. The hardware supports KVM.</p>

<p><img src="2025/03/02/RV64ILP32-ABI-Embedded-Virtualization/3.webp" alt="image" /></p>

<p><strong>Exploration Strategy</strong></p>

<p>First, Dhrystone was compiled natively for P550 Linux, and bare-metal performance data was obtained by running with random core binding. Then, the same Dhrystone code was embedded into a looping Task within the open-source EasyXMen using the “New 32-bit” toolchain. Finally, multiple KVM virtual machines were run on the P550 with core binding. Each virtual machine loaded an instance of the open-source EasyXMen, and Dhrystone performance data was collected under different scenarios. Charts were generated to compare performance differences before and after virtualization.</p>

<p><strong>Verify that the OS kernel supports the H extension and has KVM enabled</strong></p>

<p><img src="2025/03/02/RV64ILP32-ABI-Embedded-Virtualization/4.webp" alt="image" /></p>

<p><img src="2025/03/02/RV64ILP32-ABI-Embedded-Virtualization/5.webp" alt="image" /></p>

<p><strong>Ensure qemu-system-riscv64 supports KVM</strong></p>

<p><img src="2025/03/02/RV64ILP32-ABI-Embedded-Virtualization/6.webp" alt="image" /></p>

<p><strong>Porting Dhrystone to Open-Source EasyXMen</strong></p>

<p>Prepare the source code: <code class="highlighter-rouge">git clone https://github.com/iwannatto/dhrystone.git</code>. Several functions need to be implemented manually: <code class="highlighter-rouge">strcmp</code>, <code class="highlighter-rouge">strcpy</code>, <code class="highlighter-rouge">malloc</code>, and functions for calculating elapsed time.</p>

<p>The code can be debugged locally.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>qemu-system-riscv64ilp32 -s -S -cpu rv64 -M virt -m 1G -nographic -bios ~/bins/riscv/qemu-linux/fw_dynamic.bin_m64lp64 -kernel riscv_helloworld.bin

riscv64-unknown-elf-gdb riscv_helloworld.elf
</code></pre>
</div>

<p><strong>Generate the Open-Source EasyXMen Image Using the RISC-V New 32-bit Toolchain</strong></p>

<p>The kernel entry address in the open-source EasyXMen needs to be modified.</p>

<p><img src="2025/03/02/RV64ILP32-ABI-Embedded-Virtualization/7.webp" alt="image" /></p>

<p><strong>Collect Bare-Metal Dhrystone Scores on P550</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>cd Examples/riscv_helloworld/bench/
make
#text
begin=0
while \[ $begin -le 12 \]
do

cid=\`expr $begin % 4\`
  echo "####################"
  echo begin=$begin,cid=$cid
  echo "####################"
  time taskset -c $cid ./dry2nr 20000000
  ((begin++))
done
</code></pre>
</div>

<p><strong>Record Performance Data of Dhrystone Running in One and Multiple KVM Virtual Machines</strong></p>

<p><strong>Multi-core Binding Scenario (4 Guests)</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>taskset -c 0 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 1 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 2 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 3 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
</code></pre>
</div>

<p><strong>Multi-core Binding Scenario (8 Guests)</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>taskset -c 0 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 0 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 1 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 1 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 2 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 2 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 3 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 3 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
</code></pre>
</div>

<p><strong>Single-core Binding Test (1 Guest)</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>taskset -c 3 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
</code></pre>
</div>

<p><strong>Single-core Binding Test (4 Guests)</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code>taskset -c 3 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 3 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 3 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
taskset -c 3 sudo qemu-system-riscv64 --nographic --enable-kvm -M virtilp32 -cpu host -m 1024M -smp 2 -kernel riscv_helloworld.bin
</code></pre>
</div>

<p><strong>Performance Charts</strong></p>

<p>Using <code class="highlighter-rouge">taskset</code> to bind to 1 CPU core, running 1-4 EasyXMen Guest OS instances within KVM yields the following Dhrystone performance data:</p>

<p><img src="2025/03/02/RV64ILP32-ABI-Embedded-Virtualization/8.webp" alt="image" /></p>

<p>Using <code class="highlighter-rouge">taskset</code> to bind to 4 CPU cores, running 1-8 EasyXMen Guest OS instances within KVM yields the following Dhrystone performance data:</p>

<p><img src="2025/03/02/RV64ILP32-ABI-Embedded-Virtualization/9.webp" alt="image" /></p>

<p>Note: The yellow dashed line represents the performance data of running Dhrystone directly on P550 Linux. The blue bars represent the performance data after virtualization. Both datasets use the same Dhrystone source code and the same compilation parameters.</p>

<p><strong>Future Plans</strong></p>

<p>Kubuds Technology will continue to explore memory isolation, security, and stability among multiple open-source EasyXMen instances within KVM.</p>

                            </div>
                        </div>
                        <div class="post-navigation">
                            
                            <a href="/ch/post.html#news-list" class="btn btn-main news-list-link">返回新闻列表</a>
                            
                        </div>

                    </div>
                </div>
            </div>
        </section>
    </main>
</body>
<!-- Footer -->
<!-- 
<footer class="footer">
  <div class="container">
    <div class="row">
      <div class="col-md-12">
        <div class="footer-manu">
          <ul>
            <li><a href="about.html">About Us</a></li>
            <li><a href="contact.html">Contact us</a></li>
            <li><a href="service.html">How it works</a></li>
            <li><a href="faq.html">FAQ</a></li>
            <li><a href="pricing.html">Pricing</a></li>
          </ul>
        </div>
        <p class="copyright mb-0">Copyright
          <script>document.write(new Date().getFullYear())</script> &copy; Designed & Developed by <a
            href="http://www.themefisher.com">Themefisher</a>. All rights reserved.
          <br> Get More <a href="https://themefisher.com/free-bootstrap-templates/">Free Bootstrap
            Templates</a>
        </p>
      </div>
    </div>
  </div>
</footer> -->


<footer class="footer">
  <div class="footer-top">
    <div class="container">
      <div class="row">
        <div class="col-lg-4 col-md-4 ">
          <h4>联系我们</h4>
          <p>
            Weiwei Li (CEO) <br>
            <!-- Phone:  <br>
          Fax:  <br> -->
            <strong>邮箱:</strong> contact@kubuds.cn<br>
            <strong>地址:</strong> 上海市宝山区高逸路88号1幢1层108室<br>
          </p>
        </div>

        <div class="col-lg-4 col-md-4 ">
          <h4>链接</h4>
          <ul>
            <li><i class="bx bx-chevron-right"></i><a href="https://github.com/kubuds"> GitHub</a></li>
          </ul>
        </div>
        
        <div class="col-lg-4 col-md-4 ">
          <h4>关注我们</h4>
          <img src="/assets/img/contact/qrcode_wechat_public_account_100px.webp" class="img-fluid text-left"
            alt="weixin_public_qrcode">
        </div>
        
      </div>
    </div>

  </div>
  <div class="footer-copyright container">
    <div class="me-md-auto text-center ">
      <div class="copyright">
        <p>Copyright &copy; 2025 上海苦芽科技有限公司</p>
      </div>
    </div>
  </div>
</footer>

<script>
    // 新闻详情页面滚动位置保持功能
    (function () {
        const NEWS_LIST_SCROLL_KEY = 'newsListScrollPosition';
        const NEWS_LIST_TIMESTAMP_KEY = 'newsListTimestamp';

        // 为所有返回新闻列表的链接添加点击事件监听器
        function addNewsListLinkListeners() {
            const newsListLinks = document.querySelectorAll('.news-list-link');
            newsListLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    // 不需要在这里保存位置，因为位置应该在从列表页进入详情页时已经保存了
                    // 这里只需要确保链接正常工作
                });
            });
        }

        // 新闻详情页图片懒加载
        function initNewsImageLazyLoading() {
            const images = document.querySelectorAll('.post-content img');

            if (images.length === 0) return;

            const imageObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const img = entry.target;

                        // 添加加载状态
                        img.style.opacity = '0.7';
                        img.style.transition = 'opacity 0.3s ease';

                        // 预加载图片
                        const tempImg = new Image();
                        tempImg.onload = function () {
                            img.style.opacity = '1';
                            img.classList.add('loaded');
                        };
                        tempImg.onerror = function () {
                            img.style.opacity = '1';
                            img.alt = '图片加载失败';
                            img.classList.add('loaded');
                        };
                        tempImg.src = img.src;

                        imageObserver.unobserve(img);
                    }
                });
            }, {
                rootMargin: '100px 0px',
                threshold: 0.1
            });

            images.forEach(img => {
                // 为所有图片添加懒加载属性
                img.setAttribute('loading', 'lazy');
                imageObserver.observe(img);
            });
        }

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', function () {
            // 添加新闻列表链接监听器
            addNewsListLinkListeners();

            // 初始化图片懒加载
            initNewsImageLazyLoading();
        });
    })();
</script>

</html>